{
  "hash": "c7f59582d5f23bd417d106f172251526",
  "result": {
    "markdown": "---\ntitle: \"intRos: Tidy data manipulation\"\nauthor: \n  - name: Alice Trevail\n    affiliation: University of Exeter\ndescription: \"Tidy and transfrom your data using reproducible code in R\"\ndate: \"20/11/2023\"\ndate-modified: last-modified\ncategories: [tidyverse, R]\nexecute:\n  message: false\n  warning: false\n---\n\n\n# Outline\n\nThe way we collect or download data can often be different to how we analyse them. For example, have you ever needed to work on a subset of your data, add new columns, or calculate summary values? There are good reasons to do this kind of data manipulation in a reproducible way: it's less prone to errors, saves us time when repeating the process, and helps us to share our code with confidence. In this walkthrough, we'll share some of our favourite tools for reproducible data manipulation in R and the tidyverse.\n\n# Prerequisites\n\n-   Have R installed\n-   Be using R for your research\n\n# Learning objectives\n\n::: callout-note\n# Learning objectives\n\n**This introduction should allow you to:**\n\n-   Change the structure of your data using reproducible code\n-   Know where to learn more about tidyverse data manipulation\n:::\n\n# Tidy data manipulation\n\n### Why manipulate data in R?\n\n-   Reproducible\n\n-   Easy to update and re-use with new data\n\n-   Less prone to human error\n\n-   Can be quick, easy, and fun...\n\nHere's an example of how we can use the tidyverse packages (& janitor) to tidy, transform, and visualise the [palmer penguins data](https://allisonhorst.github.io/palmerpenguins/articles/intro.html):\n\n##### Penguin morphometrics\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# load the tidyverse, and other useful packages\npacman::p_load(flextable, palmerpenguins, \n               janitor, magrittr, tidyverse) \n\nvars_measurements <- c(\"culmen_length_mm\", \"culmen_depth_mm\", \"flipper_length_mm\", \"body_mass_g\")\n\n# use pipe operative from magrittr\npenguins_example <- penguins_raw %>%\n  # column names to snake_case using janitor package\n  janitor::clean_names() %>% \n  # rename columns using dplyr\n  rename(carbon = delta_13_c_o_oo,\n         nitrogen = delta_15_n_o_oo) %>%\n  # add new columns using dplyr\n  mutate(\n    # extract year using lubridate\n    year = lubridate::year(date_egg), \n    # change case in sex column using stringr\n    sex = str_to_lower(sex), \n    # take first element of species column string using stringr and purrr\n    species = str_split_i(species, pattern = \" \", i = 1)) %>% \n  # remove nas in sex column using dplyr\n  filter(!is.na(sex))\n\n# plot data using ggplot\nggplot(penguins_example, aes(x = flipper_length_mm, y = body_mass_g, \n                             # reorder sex using forcats\n                             col = fct_reorder2(sex, flipper_length_mm, body_mass_g))) +\n  facet_grid(cols = vars(species), scales = \"free\")+\n  geom_point()+\n  geom_smooth(method = lm)+\n  scale_colour_viridis_d(option = \"magma\", begin = 0.7, end = 0.3, name = \"Sex\")+\n  theme_minimal()+\n  theme(panel.border = element_rect(fill = NA))\n```\n\n::: {.cell-output-display}\n![Sexual dimporphism in Palmer penguins](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n##### Penguin isotope signatures\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npenguins_summary_isotopes <- penguins_example %>% \n  # change data format to long using tidyr\n  pivot_longer(cols = carbon:nitrogen, names_to = \"isotope\", values_to = \"value\") %>%\n  # group data using dplyr\n  group_by(species, isotope) %>% \n  # summarise data for each group using dplyr\n  summarize(mean = mean(value, na.rm = T),\n            sd =  sd(value, na.rm = T)) %>%\n  # change data format to wide using tidyr\n  pivot_wider(id_cols = species, names_from = isotope, values_from=c(mean, sd))\n\nggplot(penguins_example, aes(x = carbon, y = nitrogen, col = species)) +\n  geom_point(alpha = 0.6)+\n  geom_errorbar(data = penguins_summary_isotopes, \n                aes(x = mean_carbon, \n                    ymax = mean_nitrogen+sd_nitrogen, ymin = mean_nitrogen-sd_nitrogen, col = species),\n                inherit.aes = F, width = 0.1)+\n  geom_errorbar(data = penguins_summary_isotopes, \n                aes(y = mean_nitrogen, \n                    xmax = mean_carbon+sd_carbon, xmin = mean_carbon-sd_carbon, col = species), \n                inherit.aes = F, width = 0.1)+\n  scale_colour_viridis_d(option = \"mako\", begin = 0.75, end = 0.1, name = \"Species\")+\n  theme_minimal()+\n  theme(panel.border = element_rect(fill = NA))\n```\n\n::: {.cell-output-display}\n![Isotope signatures among Palmer penguins](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Some useful functions\n\nHere, we'll dig into the functions used in the above example to see how we processed the data:\n\n#### janitor::clean_names()\n\nLet's remind ourselves of the original data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins_raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 17\n$ studyName             <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL…\n$ `Sample Number`       <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1…\n$ Species               <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie P…\n$ Region                <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\"…\n$ Island                <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgerse…\n$ Stage                 <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adu…\n$ `Individual ID`       <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", …\n$ `Clutch Completion`   <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", …\n$ `Date Egg`            <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16,…\n$ `Culmen Length (mm)`  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34…\n$ `Culmen Depth (mm)`   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18…\n$ `Flipper Length (mm)` <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190,…\n$ `Body Mass (g)`       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 34…\n$ Sex                   <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\"…\n$ `Delta 15 N (o/oo)`   <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18…\n$ `Delta 13 C (o/oo)`   <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.298…\n$ Comments              <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult…\n```\n:::\n:::\n\n\nAnd now tidy up our column names into snake_case. (This isn't part of the tidyverse, but it is too useful not to mention)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_example <- penguins_raw %>%\n  janitor::clean_names() \n\nglimpse(penguins_example)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 17\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708…\n$ sample_number     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengu…\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"A…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\", \"F…\n$ delta_15_n_o_oo   <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,…\n$ delta_13_c_o_oo   <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, …\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult not…\n```\n:::\n:::\n\n\n#### dplyr::rename()\n\nTo rename a column\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_example %<>%\n  dplyr::rename(carbon = delta_13_c_o_oo,\n         nitrogen = delta_15_n_o_oo) \n\nglimpse(penguins_example)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 17\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708…\n$ sample_number     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengu…\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"A…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\", \"F…\n$ nitrogen          <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,…\n$ carbon            <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, …\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult not…\n```\n:::\n:::\n\n\n#### dplyr::mutate()\n\nTo add a column\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_example %<>%\n  mutate(year = 2007)\n\nglimpse(penguins_example)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 18\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708…\n$ sample_number     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengu…\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"A…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\", \"F…\n$ nitrogen          <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,…\n$ carbon            <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, …\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult not…\n$ year              <dbl> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n:::\n\n\n#### dplyr::mutate()\n\nTo add a column\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_example %<>%\n  mutate(year = \"unknown\")\n\nglimpse(penguins_example)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 18\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708…\n$ sample_number     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengu…\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"A…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\", \"F…\n$ nitrogen          <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,…\n$ carbon            <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, …\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult not…\n$ year              <chr> \"unknown\", \"unknown\", \"unknown\", \"unknown\", \"unknown…\n```\n:::\n:::\n\n\n#### lubridate::year()\n\nLubridate is great for working with dates and times. Here, we want to extract year from a column of date\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_example %<>%\n  mutate(year = lubridate::year(date_egg))\n\nglimpse(penguins_example)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 18\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708…\n$ sample_number     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengu…\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"A…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\", \"F…\n$ nitrogen          <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,…\n$ carbon            <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, …\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult not…\n$ year              <dbl> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n:::\n\n\n#### stringr::str_to_lower()\n\nChange the contents of a column to lower case\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_example %<>%\n  mutate(sex = str_to_lower(sex))\n\nglimpse(penguins_example)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 18\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708…\n$ sample_number     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengu…\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"A…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <chr> \"male\", \"female\", \"female\", NA, \"female\", \"male\", \"f…\n$ nitrogen          <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,…\n$ carbon            <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, …\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult not…\n$ year              <dbl> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n:::\n\n\n#### dplyr::select()\n\nKeep certain columns\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_tiny <- penguins_example %>%\n  select(individual_id, sex, body_mass_g)\n\nglimpse(penguins_tiny)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 3\n$ individual_id <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A1\", …\n$ sex           <chr> \"male\", \"female\", \"female\", NA, \"female\", \"male\", \"femal…\n$ body_mass_g   <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, 4250…\n```\n:::\n:::\n\n\nRemove certain columns\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_tiny2 <- penguins_example %>%\n  select(!c(study_name, sample_number, region, comments))\n\nglimpse(penguins_tiny2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 14\n$ species           <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengu…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <chr> \"male\", \"female\", \"female\", NA, \"female\", \"male\", \"f…\n$ nitrogen          <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718,…\n$ carbon            <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, …\n$ year              <dbl> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n:::\n\n\n#### dplyr::filter()\n\nFilter the rows of a dataframe by different criteria\n\n\n::: {.cell}\n::: {.cell-output-display}\n|individual_id |sex    | body_mass_g|\n|:-------------|:------|-----------:|\n|N1A1          |male   |        3750|\n|N1A2          |female |        3800|\n|N2A1          |female |        3250|\n|N2A2          |NA     |          NA|\n|N3A1          |female |        3450|\n|N3A2          |male   |        3650|\n|N4A1          |female |        3625|\n|N4A2          |male   |        4675|\n|N5A1          |NA     |        3475|\n|N5A2          |NA     |        4250|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_tiny %<>%\n  filter(!is.na(sex))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n|individual_id |sex    | body_mass_g|\n|:-------------|:------|-----------:|\n|N1A1          |male   |        3750|\n|N1A2          |female |        3800|\n|N2A1          |female |        3250|\n|N3A1          |female |        3450|\n|N3A2          |male   |        3650|\n|N4A1          |female |        3625|\n|N4A2          |male   |        4675|\n:::\n:::\n\n\n#### tidyr::pivot_longer()\n\nTransform data from wide to long (each observation in a single row)\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_isotopes_tiny <- penguins_example %>% \n  select(species, individual_id, carbon, nitrogen)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n|species   |individual_id |    carbon| nitrogen|\n|:---------|:-------------|---------:|--------:|\n|Adelie    |N1A2          | -24.69454|  8.94956|\n|Adelie    |N2A1          | -25.33302|  8.36821|\n|Chinstrap |N61A1         | -24.30229|  9.03935|\n|Chinstrap |N61A2         | -24.23592|  8.92069|\n|Gentoo    |N31A1         | -25.51390|  7.99300|\n|Gentoo    |N31A2         | -25.39369|  8.14756|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_isotopes_tiny %<>% \n  pivot_longer(cols = carbon:nitrogen, \n               names_to = \"isotope\", \n               values_to = \"value\") \n```\n:::\n\n\n#### dplyr::group_by() & dplyr::summarise()\n\nGroup by organises the data into groups, based on column values. This is useful for performing functions on each group, or summarising the data to calculate summary statistics\n\n\n::: {.cell}\n::: {.cell-output-display}\n|species   |individual_id |isotope  |     value|\n|:---------|:-------------|:--------|---------:|\n|Adelie    |N1A2          |carbon   | -24.69454|\n|Adelie    |N1A2          |nitrogen |   8.94956|\n|Adelie    |N2A1          |carbon   | -25.33302|\n|Adelie    |N2A1          |nitrogen |   8.36821|\n|Chinstrap |N61A1         |carbon   | -24.30229|\n|Chinstrap |N61A1         |nitrogen |   9.03935|\n|Chinstrap |N61A2         |carbon   | -24.23592|\n|Chinstrap |N61A2         |nitrogen |   8.92069|\n|Gentoo    |N31A1         |carbon   | -25.51390|\n|Gentoo    |N31A1         |nitrogen |   7.99300|\n|Gentoo    |N31A2         |carbon   | -25.39369|\n|Gentoo    |N31A2         |nitrogen |   8.14756|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_isotopes_tiny %<>%\n  group_by(species, isotope) %>% \n  summarize(mean = mean(value),\n            sd =  sd(value)) \n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n|species   |isotope  |       mean|        sd|\n|:---------|:--------|----------:|---------:|\n|Adelie    |carbon   | -25.013780| 0.4514735|\n|Adelie    |nitrogen |   8.658885| 0.4110765|\n|Chinstrap |carbon   | -24.269105| 0.0469307|\n|Chinstrap |nitrogen |   8.980020| 0.0839053|\n|Gentoo    |carbon   | -25.453795| 0.0850013|\n|Gentoo    |nitrogen |   8.070280| 0.1092904|\n:::\n:::\n\n\n#### tidyr::pivot_wider()\n\nTransform data from long to wide (observations across multiple columns)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_isotopes_tiny %<>%\n  pivot_wider(id_cols = species, \n              names_from = isotope, \n              values_from=c(mean, sd)) \n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n|species   | mean_carbon| mean_nitrogen| sd_carbon| sd_nitrogen|\n|:---------|-----------:|-------------:|---------:|-----------:|\n|Adelie    |   -25.01378|      8.658885| 0.4514735|   0.4110765|\n|Chinstrap |   -24.26910|      8.980020| 0.0469307|   0.0839053|\n|Gentoo    |   -25.45379|      8.070280| 0.0850013|   0.1092904|\n:::\n:::\n\n\n#### dplyr joins\n\nThere are lots of different ways to join multiple dataframes, using shared columns (e.g., an ID column). Here's an example using left_join(), which keeps all values in the left hand dataframe - in this case penguins_example.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_example %<>%\n  left_join(penguins_summary_isotopes,\n            by = join_by(species))\n\nglimpse(penguins_example)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 333\nColumns: 22\n$ study_name        <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708…\n$ sample_number     <dbl> 1, 2, 3, 5, 6, 7, 8, 13, 14, 15, 16, 17, 18, 19, 20,…\n$ species           <chr> \"Adelie\", \"Adelie\", \"Adelie\", \"Adelie\", \"Adelie\", \"A…\n$ region            <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"A…\n$ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", …\n$ stage             <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, …\n$ individual_id     <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N3A1\", \"N3A2\", \"N4A1\", \"N4A…\n$ clutch_completion <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\", \"Yes\"…\n$ date_egg          <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 200…\n$ culmen_length_mm  <dbl> 39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6…\n$ culmen_depth_mm   <dbl> 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2…\n$ flipper_length_mm <dbl> 181, 186, 195, 193, 190, 181, 195, 182, 191, 198, 18…\n$ body_mass_g       <dbl> 3750, 3800, 3250, 3450, 3650, 3625, 4675, 3200, 3800…\n$ sex               <chr> \"male\", \"female\", \"female\", \"female\", \"male\", \"femal…\n$ nitrogen          <dbl> NA, 8.94956, 8.36821, 8.76651, 8.66496, 9.18718, 9.4…\n$ carbon            <dbl> NA, -24.69454, -25.33302, -25.32426, -25.29805, -25.…\n$ comments          <chr> \"Not enough blood for isotopes.\", NA, NA, NA, NA, \"N…\n$ year              <dbl> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n$ mean_carbon       <dbl> -25.81356, -25.81356, -25.81356, -25.81356, -25.8135…\n$ mean_nitrogen     <dbl> 8.859398, 8.859398, 8.859398, 8.859398, 8.859398, 8.…\n$ sd_carbon         <dbl> 0.5871106, 0.5871106, 0.5871106, 0.5871106, 0.587110…\n$ sd_nitrogen       <dbl> 0.4282233, 0.4282233, 0.4282233, 0.4282233, 0.428223…\n```\n:::\n:::\n\n\n\n# Summary\n\nWe have shown a range of functions in R for changing the structure of your data. Hopefully, this has given an insight of how powerful the tidyverse is for efficient data manipulation. Importantly all of these processes are reproducible and limit the chances of us making errors in our workflow.\n\nIf we've missed a function that you find useful, we'd love to hear what it is. Leave us a comment below!\n\n\n### Additional Resources\n\n-   Each tidyverse package has great documentation and useful cheatsheets, available via [the tidyverse website](https://www.tidyverse.org/)\n-   The book [R for Data Science](https://r4ds.hadley.nz/), which is available online for free, explains how to get your data into R, get it into the most useful structure, transform and visualize it.\n-   For helpful visualisations of how tidyverse functions transform data structures, check out [Garrick Aden-Buie's tidyexplain](https://www.garrickadenbuie.com/project/tidyexplain/)\n-   Liza Wood, now part of the Exeter Data Analytics Hub, has a great tutorial on the tidyverse [on her website](https://liza-wood.github.io/tidyverse_intro/index.html)\n\n### Acknowledgements\n\nWe did not create this content alone! Inspiration, tips, and resources have been borrowed from multiple sources.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}